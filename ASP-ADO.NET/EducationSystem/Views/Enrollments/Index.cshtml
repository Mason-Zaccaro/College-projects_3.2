@{
    ViewData["Title"] = "Зачисления";
    
    var student = ViewBag.Student as EducationSystem.Models.Student;
    var course = ViewBag.Course as EducationSystem.Models.Course;
    var courses = ViewBag.Courses as List<EducationSystem.Models.Course>;
    var students = ViewBag.Students as List<EducationSystem.Models.Student>;
    var enrolledCourses = ViewBag.EnrolledCourses as List<EducationSystem.Models.Course>;
    var enrolledStudents = ViewBag.EnrolledStudents as List<EducationSystem.Models.Student>;
}

@if (student != null)
{
    <h2>Зачисления студента: @student.FullName</h2>
    
    <h3>Доступные курсы</h3>
    @if (courses != null && courses.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Описание</th>
                    <th>Преподаватель</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in courses)
                {
                    <tr>
                        <td>@item.Title</td>
                        <td>@item.Description</td>
                        <td>@item.Teacher.FullName</td>
                        <td>
                            <form asp-action="Enroll" method="post">
                                <input type="hidden" name="studentId" value="@student.Id" />
                                <input type="hidden" name="courseId" value="@item.Id" />
                                <button type="submit" class="btn btn-primary">Записаться</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Нет доступных курсов для записи.</p>
    }
    
    <h3>Текущие записи</h3>
    @if (enrolledCourses != null && enrolledCourses.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Описание</th>
                    <th>Преподаватель</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in enrolledCourses)
                {
                    <tr>
                        <td>@item.Title</td>
                        <td>@item.Description</td>
                        <td>@item.Teacher.FullName</td>
                        <td>
                            <form asp-action="Unenroll" method="post">
                                <input type="hidden" name="studentId" value="@student.Id" />
                                <input type="hidden" name="courseId" value="@item.Id" />
                                <button type="submit" class="btn btn-danger">Отписаться</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Студент не записан ни на один курс.</p>
    }
}
else if (course != null)
{
    <h2>Студенты курса: @course.Title</h2>
    
    <h3>Доступные студенты</h3>
    @if (students != null && students.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>Фамилия</th>
                    <th>Email</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in students)
                {
                    <tr>
                        <td>@item.FirstName</td>
                        <td>@item.LastName</td>
                        <td>@item.Email</td>
                        <td>
                            <form asp-action="Enroll" method="post">
                                <input type="hidden" name="studentId" value="@item.Id" />
                                <input type="hidden" name="courseId" value="@course.Id" />
                                <button type="submit" class="btn btn-primary">Добавить</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Нет доступных студентов для записи.</p>
    }
    
    <h3>Записанные студенты</h3>
    @if (enrolledStudents != null && enrolledStudents.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>Фамилия</th>
                    <th>Email</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in enrolledStudents)
                {
                    <tr>
                        <td>@item.FirstName</td>
                        <td>@item.LastName</td>
                        <td>@item.Email</td>
                        <td>
                            <form asp-action="Unenroll" method="post">
                                <input type="hidden" name="studentId" value="@item.Id" />
                                <input type="hidden" name="courseId" value="@course.Id" />
                                <button type="submit" class="btn btn-danger">Удалить</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>На курс пока никто не записан.</p>
    }
}

<div>
    @if (student != null)
    {
        <a asp-controller="Students" asp-action="Index">Назад к списку студентов</a>
    }
    else if (course != null)
    {
        <a asp-controller="Courses" asp-action="Index">Назад к списку курсов</a>
    }
</div>
